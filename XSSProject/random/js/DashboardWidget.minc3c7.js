$(function(){$.widget("UTEP.Dashboard",{options:{updateURL:"",layout:"",staticColumnsID:"col_",staticWidgetID:"wid_",staticContainerID:"",connectedWith:".dropzone",drag:"true",staticMenuContainerID:"",customizeID:"cmenu_",Type:"portlet",url:"none",order:"TOP",canClose:"TRUE"},getColumnID:function(){return this.options.staticColumnsID},getWidgetID:function(){return this.options.staticWidgetID},getContainerID:function(){return this.options.staticContainerID},_create:function(){this._loadLayoutFromSite(this.options.url)},_loadLayoutFromSite:function(n){var i=[[]],t=this;$.ajax({type:"GET",url:n,cache:!1,crossDomain:!0,dataType:"json",success:function(n){i=n;t.options.layout=i;t.options.staticContainerID=t.element[0].id;t._loadWidgetsFromLayout(t.options.layout);for(var r=0;r<t.options.layout.length;r++)t.options.drag==="true"&&(id=t.getColumnID()+(r+1),new Sortable(document.getElementById(id),{group:{name:t.options.connectedWith,pull:!0,put:!0},animation:500,ghostClass:"portlet-placeholder",filter:function(n){var i=$(n.target),r=i.closest(".panel").attr("id").replace("wid_",""),u=t._getWidgetObject(r);return u.Order!==2147483647||!i.hasClass("portlet-title-1")&&!i.hasClass("portlet-header")},preventOnFilter:!1,dragClass:"portlet-drag",chosenClass:"chosen",forceFallback:!0,onStart:function(){$("html").addClass("cursor-move")},onEnd:function(n){$("html").removeClass("cursor-move");var t=$(n.to).parent().attr("id");$("#"+t).Dashboard("updateCurrentLayout");$(window).trigger("resize")}}))},fail:function(){t.options.staticContainerID=t.element[0].id;t.options.staticMenuContainerID="";i=[[{Id:"1",Name:"Unable to get configuration",Location:"none",Show:!0}]];t._loadWidgetsFromLayout(i)}})},_loadWidgetsFromLayout:function(n){var t,i,r;for($("#"+this.getContainerID()).data("asyncCalls",this._countWidgets()),$("#"+this.getContainerID()).data("asyncCompleted",0),t=0;t<n.length;t++)for(i=0;i<n[t].length;i++)r=this._getWidget(n[t][i].Id,t+1,i,this.getColumnID(),this.getWidgetID(),this.getContainerID(),n[t][i].Name,n[t][i].Location,n[t][i].Show,n[t][i].AlwaysShow,n[t][i].DisableNewBadgeDate,n[t][i].Order),this._renderLoadingPage(r),this._addWidgetToMenu(r),(!0===r.Show||r.title==="Tour")&&this._renderHTML(r);this._sortWidgetMenu();this._overrideLinks(this.getContainerID())},_sortWidgetMenu:function(){var t=this.options.staticMenuContainerID.length>0,n=this.options.staticMenuContainerID;t&&$("#"+n).html($("#"+n).children().sort(function(n,t){var i=$(n).find("span").text(),r=$(t).find("span").text();return i<r?-1:i>r?1:0}))},_renderLoadingPage:function(n){var f=this.options.singleColumnLayoutOrderedContainerID,o=!1,u,e,c;f&&n.Order!==2147483647&&n.Order!==0&&(o=!0);var l=this._getLoadingDiv(n),t=$(document.createElement("div")).attr("id",this.getWidgetID()+n.id).addClass("panel panel-default").html(l),a=$("#"+n.ConID).find("#"+n.colID+n.column).find("[id*="+n.wID+"]").length;if(o){var i=$(t).clone().each(function(){this.id=`${this.id}_cln`}),r,s=!0,h=$("#"+f).children("div");for(u=0;u<h.length;u++)if(e=$(h[u]),r=e.attr("id"),e.data("order")>n.Order){s=!1;break}i.data("order",n.Order);r?s?i.insertAfter("#"+r):i.insertBefore("#"+r):i.appendTo("#"+f);t.addClass("hide-on-single-col")}a==0||n.row==0?this.options.order==="TOP"?$("#"+n.ConID).find("#"+n.colID+n.column).prepend(t):$("#"+n.ConID).find("#"+n.colID+n.column).append(t):(c=$("#"+n.ConID).find("#"+n.colID+n.column).find("[id*="+n.wID+"]").get(n.row-1).id,$(t).insertAfter($("#"+c)));n.Show||$("#"+n.ConID).find("#"+n.wID+n.id).empty()},_addWidgetToMenu:function(n){var e=this.options.staticMenuContainerID.length>0;if(e){var t=this.options.customizeID,r=this.options.staticMenuContainerID,u=this.getContainerID(),f="",i="";if(n.title!=="Tour"){n.Show&&(f="checked = 'checked'");i=n.AlwaysShow?"disabled":"";$("#"+r).append("<label for='"+t+n.id+"'><input class='hide-portlet-tog' name='applications-hide' type='checkbox' id='"+t+n.id+"' value='"+n.wID+n.id+"' "+f+" "+i+"><span class='"+i+"'>"+n.title+"<\/span><\/label>");$("#"+r).on("change","#"+t+n.id,function(){var t=$(this)[0],i=t.checked;i?$("#"+u).Dashboard("addWidget",n):$("#"+u).Dashboard("removeWidget",n)})}}},_renderHTML:function(n){var u=this.options.Type;widgetURL=n.location;var t=this.options.staticContainerID,i=this.options.singleColumnLayoutOrderedContainerID,f=this.options.staticMenuContainerID,e=this.options.customizeID;widgetURL=n.location;var o=this._AddRemoveWidgetEvent,h=this._getUnavailablePortlet,c=this._getUnavailableLink,v=this.options.staticMenuContainerID.length>0,l=this.options.canClose,a=this._DisplayContentIsUnavailable,s=this._getDisableBadgeLabel(n.DisableNewBadgeDate),r=!1;if(i&&n.Order!==2147483647&&n.Order!==0&&(r=!0),widgetURL==="none"){a(n,t,u,h,c,l,o,f,e,s,r,i);return}$("#"+n.ConID).find("#"+n.wID+n.id).html(this._getLoadingDiv(n));$.ajax({type:"GET",url:widgetURL,cache:!1,crossDomain:!0,dataType:"html",success:function(h){var c,a,l,v;$("#"+t).data("asyncCompleted",$("#"+t).data("asyncCompleted")+1);c=$.parseHTML(h,!0);$(c).find(".portlet-header").parent("div").prepend(s);$("#"+n.ConID).find("#"+n.wID+n.id).html(c);o(n,f,e);r&&(a=$(c).clone().each(function(){this.id=`${this.id}_cln`}),$("#"+i).find("#"+n.wID+n.id+"_cln").html(a));u!=="portlet"&&($("#"+n.wID+n.id+" a").attr("target","_blank"),$("#"+n.wID+n.id+" a").attr("rel","noopener"));$(".UtepIcons.icon-remove.close-portlet").attr("tabindex",0);l=$("#"+n.ConID).find("#"+n.colID+n.column).find("#"+n.wID+n.id).find(".portlet");l.length>0&&(v=l.parent().width(),l.css("width",Math.ceil(v)))},statusCode:{404:function(){a(n,t,u,h,c,l,o,f,e,s,r,i)},500:function(){a(n,t,u,h,c,l,o,f,e,s,r,i)}},fail:function(){a(n,t,u,h,c,l,o,f,e,s,r,i)},complete:function(){}})},_AddRemoveWidgetEvent:function(n,t,i){$("#"+n.wID+n.id+" .close-portlet").on("click",function(){$("#"+n.ConID).find("#"+n.wID+n.id).slideUp();$("#"+t).find("#"+i+n.id).click()});$("#"+n.wID+n.id+" .close-portlet").on("keyup",function(r){r.keyCode==13&&($("#"+n.ConID).find("#"+n.wID+n.id).slideUp(),$("#"+t).find("#"+i+n.id).click())})},_DisplayContentIsUnavailable:function(n,t,i,r,u,f,e,o,s,h,c,l){var a,v,y;$("#"+t).data("asyncCompleted",$("#"+t).data("asyncCompleted")+1);a="";v=$("#"+n.ConID).find("#"+n.colID+n.column).find("#"+n.wID+n.id);a=i==="portlet"?r(n.id,n.title,f):u(n.id,n.title);$(v).html(a);c&&(y=$(a).clone().each(function(){this.id=`${this.id}_cln`}),$("#"+l).find("#"+n.wID+n.id+"_cln").html(y));$(v).find(".portlet-header").parent("div").prepend(h);e(n,o,s)},addWidget:function(n){var t=$("#"+n.ConID).find("#"+n.wID+n.id).parent();t.prepend($("#"+n.ConID).find("#"+n.wID+n.id));$("#"+n.ConID).find("#"+n.wID+n.id).slideDown();$("#"+n.ConID).trigger("resize");this._renderHTML(n);this.updateCurrentLayout()},_getWidget:function(n,t,i,r,u,f,e,o,s,h,c,l){return{id:n,column:t,row:i,colID:r,wID:u,ConID:f,title:e,location:o,Show:s,AlwaysShow:h,DisableNewBadgeDate:c,Order:l}},removeWidget:function(n){var t=n.wID+n.id;$("#"+this.getContainerID()).find("#"+t).slideUp().empty();this.updateCurrentLayout()},_overrideLinks:function(n){var t=this.options.staticWidgetID;$("#"+n).on("submit",".same_window",function(n){n.preventDefault()})},getAttributeFromWidget:function(n){for(var r,t,o,u,s=this.getContainerID(),h=this.getColumnID(),f=this.getWidgetID(),c=this.options.updateURL,l=this.options.customizeID,e=$("#"+s).find("[id*="+h+"]"),i=0;i<e.length;i++)for(r=$(e).eq(i).find("[id*="+f+"]"),t=0;t<r.length;t++)if(o=r.eq(t).attr("id").replace(f,""),u=this._getWidgetObject(o),u.Name===n)return u.otherAttr;return null},setAttributeForWidget:function(n,t){for(var u,i,s,f,h=this.getContainerID(),c=this.getColumnID(),e=this.getWidgetID(),l=this.options.updateURL,a=this.options.customizeID,o=$("#"+h).find("[id*="+c+"]"),r=0;r<o.length;r++)for(u=$(o).eq(r).find("[id*="+e+"]"),i=0;i<u.length;i++)s=u.eq(i).attr("id").replace(e,""),f=this._getWidgetObject(s),f.Name===n&&(f.otherAttr=t);this.updateCurrentLayout()},updateCurrentLayout:function(){for(var r,u,t,f,n,h,c,l=this.getContainerID(),a=this.getColumnID(),e=this.getWidgetID(),v=this.options.updateURL,y=this.options.customizeID,o=$("#"+l).find("[id*="+a+"]"),s=[],i=0;i<o.length;i++){for(r=[],u=$(o).eq(i).find("[id*="+e+"]"),t=0;t<u.length;t++){if(f=u.eq(t).attr("id").replace(e,""),n=this._getWidgetObject(f),n.Show=$("#"+y+f+":checked").length>0,n.AlwaysShow&&!n.Show){n.Show=!0;return}r.push(n)}s.push(r)}h=new Date;c=h.getTime();$.ajax({type:"POST",url:v,cache:!1,dataType:"json",data:{jsonDashboard:JSON.stringify(s),time:c}}).done(function(n){n.Status==="not-authenticated"&&window.location.reload()})},_getWidgetObject:function(n){for(var i,r=this.options.layout,t=0;t<r.length;t++)for(i=0;i<r[t].length;i++)if(r[t][i].Id==n)return r[t][i]},_countWidgets:function(){for(var t,i=this.options.layout,r=0,n=0;n<i.length;n++)for(t=0;t<i[n].length;t++)!0===i[n][t].Show&&r++;return r},_getLoadingDiv:function(n){return loadingDiv="",loadingDiv=this.options.Type==="portlet"?this._getLoadingPortlet(n.id,n.title,this.options.canClose):this._getLoadingLinks()},_getDisableBadgeLabel:function(n){return Date.parse(n)>new Date?"<div class='portlet-header portlet-new-badge'><h5 class='portlet-title-1'>NEW<\/h5><div class='clearfix'><\/div><\/div>":""},_getLoadingPortlet:function(n,t,i){return closeText="",i==="TRUE"&&(closeText="<div class='UtepIcons icon-remove close-portlet'><span class='off-screen'>Close Portlet<\/span><\/div>"),"<div id='"+n+"' class='portlet portlet-preloader ui-sortable-handle'><div class='portlet-header'><h5 class='portlet-title-1'>"+t+"<\/h5><div class='portlet-handles'>"+closeText+"<\/div><div class='clearfix'><\/div><\/div><div class='portlet-body'><div class='preloader-wrap'><div class='preloader'><div class='scroll_cir'><span>Loading<\/span><div class='cir0'><\/div><div class='cir1'><\/div><div class='cir2'><\/div><div class='cir3'><\/div><div class='cir4'><\/div><\/div><\/div><\/div><\/div><\/div>"},_getLoadingLinks:function(n){return"<div id='"+n+"' class='portlet-preloader ui-sortable-handle'><div class='portlet-body'><div class='preloader-wrap'><div class='preloader'><div class='scroll_cir'><span>Loading<\/span><div class='cir0'><\/div><div class='cir1'><\/div><div class='cir2'><\/div><div class='cir3'><\/div><div class='cir4'><\/div><\/div><\/div><\/div><\/div><\/div>"},_getUnavailablePortlet:function(n,t,i){return closeText="",i==="TRUE"&&(closeText="<div class='UtepIcons icon-remove close-portlet'><span class='off-screen'>Close Portlet<\/span><\/div>"),"<div id='"+n+"' class='portlet portlet-unavailable '><div class='portlet-header'><h5 class='portlet-title-1'>"+t+"<\/h5><div class='portlet-handles'>"+closeText+"<\/div><div class='clearfix'><\/div><\/div><div class='portlet-body'><div class='preloader-wrap'><div class='unavailable-marker'><div class='UtepIcons icon-pickandshovel'><\/div><div class='unavailable-text'><a class='error-info' href='https://www.utep.edu/information-resources/ec/planned-system-outage.html' target='_blank' rel='noopener'>content is currently unavailable<\/a><\/div><\/div><\/div><\/div><\/div>"},_getUnavailableLink:function(n,t){return"<div id='"+n+"' class='ui-sortable-handle'><div class='portlet-header'><h5 class='portlet-title-1'>"+t+"<\/h5><div class='portlet-handles'><\/div><div class='clearfix'><\/div><\/div><div class='portlet-body'><div class='preloader-wrap'><div class='unavailable-marker'><div class='UtepIcons icon-pickandshovel'><\/div><div class='unavailable-text'><a href='https://www.utep.edu/information-resources/ec/planned-system-outage.html' target='_blank' rel='noopener'>content is currently unavailable<\/a><\/div><\/div><\/div><\/div><\/div>"}});$("#menu-wrap").length>0?$(".container").each(function(){$(this).addClass("menu-wrap-spacer")}):$(".container").removeClass("menu-wrap-spacer")});